<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Brother Fashion</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #1e40af; --light: #f3f4f6; }
        body { background: var(--light); padding: 20px; font-family: sans-serif; }
        .login-box { background: white; padding: 30px; border-radius: 10px; text-align: center; max-width: 350px; margin: 50px auto; }
        .form-control { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; }
        .btn { width: 100%; padding: 10px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px; }
        .card { background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .product-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 10px 0; }
        .btn-sm { padding: 5px 10px; font-size: 0.8rem; border: none; border-radius: 3px; cursor: pointer; color: white; margin-left: 5px; }
        
        /* Multiple Image Input Style */
        .img-input-group { background: #f9fafb; padding: 10px; border-radius: 5px; border: 1px dashed #ccc; margin-bottom: 10px; }
        .img-input-group label { font-size: 0.9rem; font-weight: bold; color: #555; }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-box">
        <h3>Admin Login</h3>
        <input type="password" id="pass" class="form-control" placeholder="Password">
        <button onclick="checkLogin()" class="btn">Login</button>
    </div>

    <div id="dashboard" style="display:none; max-width: 600px; margin: 0 auto;">
        <h2 style="text-align:center; margin-bottom:20px; color: var(--primary);">Admin Dashboard</h2>
        
        <div class="card" style="display:flex; justify-content:space-around; text-align:center;">
            <div><h2 id="vCount">0</h2><small>Visitors</small></div>
            <div><h2 id="sCount">0</h2><small>Sales</small></div>
            <div><h2 id="rCount">0</h2><small>Revenue</small></div>
        </div>

        <div class="card">
            <h4>Update Announcement</h4>
            <input type="text" id="promoInp" class="form-control" placeholder="Offer text...">
            <button onclick="window.updatePromo()" class="btn" style="background:orange; color:black;">Update</button>
        </div>

        <div class="card">
            <h4>Add New Product</h4>
            <input type="text" id="pName" class="form-control" placeholder="Product Name">
            <div style="display:flex; gap:10px;">
                <input type="number" id="pPrice" class="form-control" placeholder="New Price">
                <input type="number" id="pOld" class="form-control" placeholder="Old Price">
            </div>

            <div class="img-input-group">
                <label>Product Images (Max 5):</label>
                <input type="text" id="img1" class="form-control" placeholder="Link 1 (Main Image) *Required">
                <input type="text" id="img2" class="form-control" placeholder="Link 2 (Optional)">
                <input type="text" id="img3" class="form-control" placeholder="Link 3 (Optional)">
                <input type="text" id="img4" class="form-control" placeholder="Link 4 (Optional)">
                <input type="text" id="img5" class="form-control" placeholder="Link 5 (Optional)">
            </div>

            <button onclick="window.addProduct()" class="btn">Add Product</button>
        </div>

        <div class="card">
            <h4>All Products List</h4>
            <div id="pList">Loading...</div>
        </div>
        
        <button onclick="window.addRevenue()" class="btn" style="background:#10b981; margin-bottom:20px;">+ Add Manual Sale Money</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, remove, update, onValue, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD56PSyp7nVXKXphbSwgAJL6kUb33yb2iQ",
            authDomain: "brother-fashion-house.firebaseapp.com",
            databaseURL: "https://brother-fashion-house-default-rtdb.firebaseio.com",
            projectId: "brother-fashion-house",
            storageBucket: "brother-fashion-house.appspot.com",
            messagingSenderId: "30910144708",
            appId: "1:30910144708:web:7352698277af2c8aae6991",
            measurementId: "G-TE8CRXPBL4"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.addProduct = () => {
            const name = document.getElementById('pName').value;
            const price = document.getElementById('pPrice').value;
            const old = document.getElementById('pOld').value;
            
            // ৫টি ইনপুট থেকে ছবির লিংক নেওয়া
            const img1 = document.getElementById('img1').value.trim();
            const img2 = document.getElementById('img2').value.trim();
            const img3 = document.getElementById('img3').value.trim();
            const img4 = document.getElementById('img4').value.trim();
            const img5 = document.getElementById('img5').value.trim();

            // একটি লিস্টে ছবিগুলো সাজানো (ফাঁকা ঘর বাদ দেওয়া)
            let imageList = [img1, img2, img3, img4, img5].filter(url => url !== "");

            // যদি কোনো ছবি না দেয়, ডিফল্ট ছবি বসানো
            if(imageList.length === 0) imageList.push("https://via.placeholder.com/150");

            if(name && price) {
                push(ref(db, 'products'), {
                    name, 
                    price, 
                    oldPrice: old, 
                    img: imageList[0],    // প্রথম ছবি মেইন হিসেবে থাকবে (থাম্বনেইল দেখানোর জন্য)
                    images: imageList,    // সব ছবি স্লাইডারের জন্য
                    sold: false, 
                    timestamp: Date.now()
                });
                alert("Product Added Successfully!");
                
                // ফর্ম ক্লিয়ার করা
                document.getElementById('pName').value = '';
                document.getElementById('pPrice').value = '';
                document.getElementById('pOld').value = '';
                document.getElementById('img1').value = '';
                document.getElementById('img2').value = '';
                document.getElementById('img3').value = '';
                document.getElementById('img4').value = '';
                document.getElementById('img5').value = '';
            } else {
                alert("Please enter Name, Price and at least 1 Image!");
            }
        };

        window.deleteProduct = (id) => {
            if(confirm("Are you sure you want to delete this product?")) remove(ref(db, `products/${id}`));
        };

        window.toggleSold = (id, status) => {
            update(ref(db, `products/${id}`), { sold: !status });
        };

        window.updatePromo = () => {
            update(ref(db), { promo: document.getElementById('promoInp').value });
            alert("Promo Updated!");
        };
        
        window.addRevenue = () => {
            let amount = prompt("Enter Sale Amount (Tk):");
            if(amount) update(ref(db, 'stats'), { revenue: increment(parseInt(amount)), sales: increment(1) });
        };

        // পণ্য লোড করা
        onValue(ref(db, 'products'), (snap) => {
            const list = document.getElementById('pList');
            list.innerHTML = '';
            if(snap.val()) {
                const arr = Object.entries(snap.val()).map(([k,v]) => ({id:k, ...v})).reverse();
                arr.forEach(p => {
                    // মেইন ছবি দেখাবে (p.img)
                    list.innerHTML += `
                        <div class="product-item">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <img src="${p.img}" width="40" height="40" style="object-fit:cover; border-radius:4px;"> 
                                <div>
                                    <b>${p.name}</b><br>
                                    <small>৳${p.price}</small>
                                </div>
                            </div>
                            <div>
                                <button onclick="window.toggleSold('${p.id}', ${p.sold})" class="btn-sm" style="background:${p.sold?'#444':'orange'}">${p.sold?'Unsold':'Sold'}</button>
                                <button onclick="window.deleteProduct('${p.id}')" class="btn-sm" style="background:red"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>`;
                });
            } else { list.innerHTML = "No products found"; }
        });

        onValue(ref(db, 'stats'), (snap) => {
            const s = snap.val() || {visitors:0, sales:0, revenue:0};
            document.getElementById('vCount').innerText = s.visitors || 0;
            document.getElementById('sCount').innerText = s.sales || 0;
            document.getElementById('rCount').innerText = '৳' + (s.revenue || 0);
        });
    </script>

    <script>
        function checkLogin() {
            if(document.getElementById('pass').value === "Brothers@2026") {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
            } else { alert("Wrong Password!"); }
        }
    </script>
</body>
</html>
